{% extends "base.html" %}
{% block content %}
<div class="container py-4" style="max-width: 760px;">
  <div class="d-flex justify-content-between align-items-center">
    <h3 class="mb-0">{{ p.title }}</h3>
    <span class="badge text-bg-dark px-3 py-2">Score: {{ p.score }}</span>
  </div>
  <div class="text-muted small mb-3">
    Movie: <strong>{{ p.movie_title }}</strong> ‚Ä¢ by {{ p.proposer|default:"Anonymous" }} ‚Ä¢ {{ p.created_at|date:"Y-m-d H:i" }}
    {% if not p.is_open %}<span class="badge text-bg-secondary ms-2">Closed</span>{% endif %}
  </div>

  {% if p.description %}
    <p>{{ p.description }}</p>
  {% endif %}

  {% if p.is_open %}
    {% if request.user.is_authenticated %}
      <form method="post" action="{% url 'petitions:vote' p.pk %}" class="d-flex gap-2 mt-3">
        {% csrf_token %}
        <button name="value" value="up" class="btn btn-success">üëç Upvote</button>
        <button name="value" value="down" class="btn btn-danger">üëé Downvote</button>
      </form>
      {% if user_vote %}
        <p class="text-muted mt-2">Your vote: {{ user_vote.value|yesno:"+1,-1" }}</p>
      {% endif %}
    {% else %}
      <div class="alert alert-info mt-3">Please <a href="{% url 'login' %}">log in</a> to vote.</div>
    {% endif %}
  {% else %}
    <div class="alert alert-secondary mt-3">Voting closed.</div>
  {% endif %}
</div>
{% endblock %}